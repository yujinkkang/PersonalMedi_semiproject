DROP SEQUENCE QUESTION_BOARDNOSEQ;
DROP SEQUENCE QUESTION_GROUPNOSEQ;
DROP SEQUENCE QUESTION_READCOUNT;
DROP TABLE QUESTION;

CREATE SEQUENCE QUESTION_BOARDNOSEQ;  --글 번호
CREATE SEQUENCE QUESTION_GROUPNOSEQ;  --그룹 번호
CREATE SEQUENCE QUESTION_READCOUNT;   --조회수

--글 번호, 작성자, 
--그룹번호, 그룹순서(LEVEL), 제목탭, 제목, 내용, 작성일, 조회수
CREATE TABLE QUESTION(
    QUESTION_BOARDNO NUMBER PRIMARY KEY,
    MEMBER_SEQ NUMBER REFERENCES MEMBER(MEMBER_SEQ) NOT NULL,
    
    QUESTION_GROUPNO NUMBER NOT NULL,
    QUESTION_LEVEL NUMBER NOT NULL,
    QUESTION_TITLETAB NUMBER NOT NULL,
    QUESTION_TITLE VARCHAR2(200) NOT NULL,
    QUESTION_CONTENT VARCHAR2(4000) NOT NULL,
    QUESTION_REGDATE DATE NOT NULL,
    
    QUESTION_READCOUNT NUMBER NOT NULL
);

select * from question
  INSERT INTO QUESTION VALUES(QUESTION_BOARDNOSEQ.NEXTVAL, 1, 
  (SELECT QUESTION_GROUPNO FROM QUESTION WHERE QUESTION_BOARDNO =#{question_boardno}), 
  (SELECT QUESTION_LEVEL FROM QUESTION WHERE QUESTION_BOARDNO =#{question_boardno})+1, 
  (SELECT QUESTION_TITLETAB FROM QUESTION WHERE QUESTION_BOARDNO =#{question_boardno})+1,
  #{question_title}, #{question_content}, SYSDATE, 0) 




INSERT INTO QUESTION VALUES(QUESTION_BOARDNOSEQ.NEXTVAL, #{member_id}, QUESTION_GROUPNOSEQ.NEXTVAL, 0, 1, #{question_title}, #{question_content}, SYSDATE, 0) 

  INSERT INTO QUESTION VALUES(QUESTION_BOARDNOSEQ.NEXTVAL, #{member_id}, (SELECT QUESTION_GROUPNO FROM QUESTION WHERE QUESTION_BOARDNO =#{question_boardno}), (SELECT QUESTION_GROUPSEQ FROM QUESTION WHERE QUESTION_BOARDNO =#{question_boardno})+1, (SELECT QUESTION_TITLETAB FROM QUESTION WHERE QUESTION_BOARDNO =#{question_boardno})+1, #{question_title}, #{question_content}, SYSDATE, 0) 


MERGE INTO QUESTION A USING MEMBER B ON (A.MEMBER_SEQ = B.MEMBER_SEQ) 
INSERT VALUES(QUESTION_BOARDNOSEQ.NEXTVAL, B.MEMBER_SEQ, )

  	SELECT COUNT(*) FROM (
	SELECT ROWNUM AS RNUM, A.* FROM
		(SELECT B.MEMBER_ID, A.* FROM QUESTION A, MEMBER B
			WHERE A.MEMBER_SEQ = B.MEMBER_SEQ
			AND QUESTION_TITLE LIKE '%14%'
			ORDER BY QUESTION_GROUPNO DESC, QUESTION_LEVEL, QUESTION_BOARDNO DESC) A) B


--전체 게시판 쿼리
SELECT B.* FROM (
	SELECT ROWNUM AS RNUM, A.* FROM
		(SELECT * FROM QUESTION
			ORDER BY QUESTION_GROUPNO DESC, QUESTION_LEVEL, QUESTION_BOARDNO DESC) A) B

--총 개수 (ROWNUM의 마지막 번호)
SELECT COUNT(*) FROM (
	SELECT ROWNUM AS RNUM, A.* FROM
		(SELECT * FROM QUESTION
			ORDER BY QUESTION_GROUPNO DESC, QUESTION_LEVEL, QUESTION_BOARDNO DESC) A) B

--ROWNUM으로 n부터 m까지
SELECT B.* FROM (
	SELECT ROWNUM AS RNUM, A.* FROM
		(SELECT * FROM QUESTION
			ORDER BY QUESTION_GROUPNO DESC, QUESTION_LEVEL, QUESTION_BOARDNO DESC) A) B
WHERE RNUM BETWEEN 2 AND 20

--제목으로 검색
  	SELECT B.* FROM (
	SELECT ROWNUM AS RNUM, A.* FROM
		(SELECT B.MEMBER_ID, A.* FROM QUESTION A, MEMBER B
			WHERE A.MEMBER_SEQ = B.MEMBER_SEQ
			AND QUESTION_TITLE LIKE '%14%'
			ORDER BY QUESTION_GROUPNO DESC, QUESTION_LEVEL, QUESTION_BOARDNO DESC) A) B

--내용으로 검색
SELECT * FROM (
	SELECT ROWNUM, A.* FROM
		(SELECT * FROM QUESTION
			ORDER BY QUESTION_GROUPNO DESC, QUESTION_LEVEL, QUESTION_BOARDNO DESC) A
)
WHERE QUESTION_CONTENT LIKE '%내용%'

--제목+내용으로 검색
SELECT * FROM (
	SELECT ROWNUM, A.* FROM
		(SELECT * FROM QUESTION
			ORDER BY QUESTION_GROUPNO DESC, QUESTION_LEVEL, QUESTION_BOARDNO DESC) A
)
WHERE QUESTION_TITLE LIKE '%15%' OR QUESTION_CONTENT LIKE '%14%'

--내가 쓴 글 보기
SELECT * FROM (
	SELECT ROWNUM, A.* FROM
		(SELECT * FROM QUESTION
			ORDER BY QUESTION_GROUPNO DESC, QUESTION_LEVEL, QUESTION_BOARDNO DESC) A
)
WHERE MEMBER_SEQ = 2

--남이 쓴 글 보기
SELECT * FROM (
	SELECT ROWNUM, A.* FROM
		(SELECT * FROM QUESTION
			ORDER BY QUESTION_GROUPNO DESC, QUESTION_LEVEL, QUESTION_BOARDNO DESC) A
)
WHERE MEMBER_SEQ = 1

INSERT INTO QUESTION VALUES
(QUESTION_BOARDNOSEQ.NEXTVAL, 1, 40, 2, 1, '40번 답글1', '14번 답글 내용', SYSDATE, 0);
INSERT INTO QUESTION VALUES
(QUESTION_BOARDNOSEQ.NEXTVAL, 1, 41, 2, 1, '41번 답글1', '14번 답글 내용', SYSDATE, 0);
INSERT INTO QUESTION VALUES
(QUESTION_BOARDNOSEQ.NEXTVAL, 1, 42, 2, 1, '42번 답글1', '14번 답글 내용', SYSDATE, 0);
INSERT INTO QUESTION VALUES
(QUESTION_BOARDNOSEQ.NEXTVAL, 1, 43, 2, 1, '43번 답글1', '14번 답글 내용', SYSDATE, 0);
INSERT INTO QUESTION VALUES
(QUESTION_BOARDNOSEQ.NEXTVAL, 1, 44, 2, 1, '44번 답글1', '14번 답글 내용', SYSDATE, 0);
INSERT INTO QUESTION VALUES
(QUESTION_BOARDNOSEQ.NEXTVAL, 1, 45, 2, 1, '45번 답글1', '14번 답글 내용', SYSDATE, 0);
INSERT INTO QUESTION VALUES
(QUESTION_BOARDNOSEQ.NEXTVAL, 1, 46, 2, 1, '46번 답글1', '14번 답글 내용', SYSDATE, 0);
INSERT INTO QUESTION VALUES
(QUESTION_BOARDNOSEQ.NEXTVAL, 1, 47, 2, 1, '47번 답글1', '14번 답글 내용', SYSDATE, 0);
INSERT INTO QUESTION VALUES
(QUESTION_BOARDNOSEQ.NEXTVAL, 1, 48, 2, 1, '48번 답글1', '14번 답글 내용', SYSDATE, 0);
INSERT INTO QUESTION VALUES
(QUESTION_BOARDNOSEQ.NEXTVAL, 1, 49, 2, 1, '49번 답글1', '14번 답글 내용', SYSDATE, 0);
INSERT INTO QUESTION VALUES
(QUESTION_BOARDNOSEQ.NEXTVAL, 1, 50, 2, 1, '50번 답글1', '14번 답글 내용', SYSDATE, 0);
INSERT INTO QUESTION VALUES
(QUESTION_BOARDNOSEQ.NEXTVAL, 1, 51, 2, 1, '51번 답글1', '14번 답글 내용', SYSDATE, 0);
INSERT INTO QUESTION VALUES
(QUESTION_BOARDNOSEQ.NEXTVAL, 1, 52, 2, 1, '52번 답글1', '14번 답글 내용', SYSDATE, 0);


INSERT INTO QUESTION VALUES
(QUESTION_BOARDNOSEQ.NEXTVAL, 3, QUESTION_GROUPNOSEQ.NEXTVAL, 1, 0, '51번 질문', '15번 내용', SYSDATE, 0);
INSERT INTO QUESTION VALUES
(QUESTION_BOARDNOSEQ.NEXTVAL, 3, QUESTION_GROUPNOSEQ.NEXTVAL, 1, 0, '52번 질문', '15번 내용', SYSDATE, 0);
